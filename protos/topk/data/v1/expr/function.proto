syntax = "proto3";
package topk.data.v1;

import "topk/data/v1/value.proto";

message FunctionExpr {
  message VectorDistance {
    string field = 1;
    // Deprecated in favor of `query`.
    Vector dense_query = 2 [deprecated = true];
    // Deprecated in favor of `query`.
    SparseVector sparse_query = 3 [deprecated = true];
    // Query value to compute distance against.
    Value query = 4;
    // Skip vector score refinement if set to `true`.
    // This will improve performance for large top_k values at the cost of lower quality.
    // Intended to be used in conjunction with a custom reranker on top of the returned candidates.
    bool skip_refine = 5;
  }

  message Bm25Score {}

  message SemanticSimilarity {
    // Field with semantic index to compute similarity against.
    string field = 1;
    // Query to embed and compute similarity with.
    string query = 2;
  }

  message MultiVectorDistance {
    string field = 1;
    Value query = 2;
  }

  oneof func {
    VectorDistance vector_distance = 1;
    Bm25Score bm25_score = 2;
    SemanticSimilarity semantic_similarity = 3;
    MultiVectorDistance multi_vector_distance = 4;
  }
}
